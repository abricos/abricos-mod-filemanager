<!--[*]
[tt=window]_sys[/tt]
[script]upload.php[/script]

[bkvar=ftypelsti]
	<tr align="center">
		<td>{v#ext}</td>
		<td>{v#fsize}</td>
		<td>{v#imgsize}</td>
	</tr>
[/bkvar]
[bkvar=ok]
	window.opener.Brick.mod.filemanager.fileUploaders.setFile({v#winid}, '{v#fhash}', '{v#fname}');
	self.close();
[/bkvar]

[bkvar=error]
	var el = document.getElementById('errorpanel');
	if (el){ el.style.display = ''; }
	var elErr = document.getElementById('et-{v#errnum}');
	if (elErr){ elErr.style.display = ''; }
[/bkvar]

[bkvar=command][/bkvar]

[*]-->

<style type="text/css">
	.mod-filemanager #uploadform #errorpanel {
		color: red;
	}
	.mod-filemanager #uploadform table {
		border-width: 0;
		width: 100%;
	}
	.mod-filemanager #uploadform .contflist {
		overflow-y: auto;
		height: 210px;
	}
	
</style>
<div class="mod-filemanager">
<div>
	{#filemanager.upload_freespace} {v#freespace}
</div> 
<form onsubmit="return beginUpload();" id="uploadform" action="/filemanager/upload.html?do=upload&userid={v#userid}&winid={v#winid}&sysfolder={v#sysfolder}&folderid={v#folderid}&folderpath={v#folderpath}" enctype="multipart/form-data" method="post">

	<div style="text-align: right;">
		<a href="#" onclick="self.close()">{#filemanager.upload_close}</a>
	</div>

	<fieldset>
		<legend>{#filemanager.upload_loadfile}</legend>
		
		<div id="btnsUpload">
			<input type="file" name="uploadfile" id="uploadfile" size="30" />
			<input type="submit" class="button" name="upload" value="{#filemanager.upload_load}" />
		</div>
		<div id="loading" style="display: none">
			<img src="/images/loading.gif" />&nbsp;Идет загрузка файла, пожалуйста, подождите...
		</div>
		<div id="errorpanel" style="display: none" >
			Не удалось загрузить файл "<b>{v#fname}</b>"<br />
			<span id="et-1" style="display: none;">Неизвестный тип файла</span>
			<span id="et-2" style="display: none;">Размер файла превышает допустимый</span>
			<span id="et-3" style="display: none;">Ошибка сервера</span>
			<span id="et-4" style="display: none;">Размер изображения превышает допустимый</span>
			<span id="et-5" style="display: none;">Недостаточно свободного места в вашем профиле</span>
			<span id="et-6" style="display: none;">Нет прав на загрузку файла</span>
			<span id="et-7" style="display: none;">Файл с таким именем уже загружен</span>
			<span id="et-8" style="display: none;">Необходимо выбрать файл для загрузки</span>
			<span id="et-9" style="display: none;">Некорректное изображение</span>
			<span id="et-10" style="display: none;">Некорректное изображение</span>
		</div>						
	</fieldset>
	<fieldset>
		<legend>Разрешенные типы файлов и их размеры</legend>
		<div class="contflist">
			<table border="1">
				<thead>
					<tr align="center">
						<td>{#filemanager.upload_filetype}</td>
						<td>{#filemanager.upload_maxfsize}</td>
						<td>{#filemanager.upload_maxpsize}</td>
					</tr>
				</thead>
				<tbody>
					{v#ftypelst}
				</tbody>
			</table>
		</div>
	</fieldset>
   	
	<div align="center" style="margin-top:10px">
		<input type="button" class="button" value="{#filemanager.upload_close}" onclick="window.close();" />
	</div>	
</form>

</div>
<script type="text/javascript">
	[bkvar]command[/bkvar]
	
	var beginUpload = function(){
		var file = document.getElementById('uploadfile');
		if (!file.value){
			alert('Необходимо выбрать файл');
			return false;
		}
		document.getElementById('btnsUpload').style.display = 'none';
		document.getElementById('loading').style.display = '';
		document.getElementById('btnsUpload').style.display = 'errorpanel';
		
		return true;
	};
</script>